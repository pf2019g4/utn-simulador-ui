<mat-toolbar color="primary">
  <mat-toolbar-row>
    <button mat-icon-button routerLink="/escenarios">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h1 *ngIf="!escenario.id">Nuevo Escenario</h1>
    <h1 *ngIf="escenario.id">Editar Escenario</h1>
  </mat-toolbar-row>
</mat-toolbar>
<div class="form-container">

  <mat-card class="form-card">
    <mat-card-header>
      <mat-card-title>Datos Basicos</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="escenarioForm" class="form">
        <mat-form-field class="form-field">
          <input autofocus matInput placeholder="Titulo" [formControl]="titulo" [(ngModel)]="escenario.titulo"
            [(value)]="escenario.titulo">
          <mat-error *ngIf="escenario.invalid">Required field</mat-error>
        </mat-form-field>
        <mat-form-field class="form-field">
          <input type="number" matInput placeholder="Cantidad de Periodos" [formControl]="maximosPeriodos"
            [(ngModel)]="escenario.maximosPeriodos" [(value)]="escenario.maximosPeriodos">
          <mat-error *ngIf="escenario.invalid">Required field</mat-error>
        </mat-form-field>
        <mat-form-field class="form-field">
          <input matInput placeholder="Nombre Periodos" [formControl]="nombrePeriodos"
            [(ngModel)]="escenario.nombrePeriodos" [(value)]="escenario.nombrePeriodos">
          <mat-error *ngIf="escenario.invalid">Required field</mat-error>
        </mat-form-field>
        <mat-form-field class="form-field">
          <textarea cdkTextareaAutosize matInput placeholder="Descripcion" [formControl]="descripcion"
            [(ngModel)]="escenario.descripcion" [(value)]="escenario.descripcion"></textarea>
          <mat-error *ngIf="escenario.invalid">Required field</mat-error>
        </mat-form-field>
        <mat-form-field class="form-field">
          <input type="number" matInput placeholder="Porcentaje de Impuestos" [formControl]="impuestoPorcentaje"
            [(ngModel)]="escenario.impuestoPorcentaje" [(value)]="escenario.impuestoPorcentaje">
          <mat-error *ngIf="escenario.invalid">Required field</mat-error>
        </mat-form-field>

        <mat-form-field class="example-chip-list">
          <mat-chip-list #chipList>
            <mat-chip *ngFor="let curso of escenario.cursos;" removable="true" (removed)="removeCurso(curso)">
              {{curso.nombre}}
              <mat-icon matChipRemove>cancel</mat-icon>
            </mat-chip>
            <input placeholder="Curso..." #cursosInput [formControl]="cursos" [matAutocomplete]="auto"
              [matChipInputFor]="chipList" [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
              matChipInputAddOnBlur="true">
          </mat-chip-list>
          <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selectedCurso($event)">
            <mat-option *ngFor="let curso of filtredCursos | async;" [value]="curso">
              {{curso.nombre}}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
      </form>
    </mat-card-content>
  </mat-card>

  <mat-card class="balance-inicial-card" *ngIf="escenario.balanceInicial">
    <mat-card-header>
      <mat-card-title>Balance Inicial</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="balance-inicial-content">
        <div>
          <div style="margin-left:16px;">Activo</div>
          <form [formGroup]="activoForm" class="balance-form" *ngIf="escenario.balanceInicial.activo">
            <mat-form-field class="form-field">
              <input autofocus matInput placeholder="Caja" [formControl]="caja" type="number"
                [(ngModel)]="escenario.balanceInicial.activo.caja" [(value)]="escenario.balanceInicial.activo.caja">
            </mat-form-field>
            <mat-form-field class="form-field">
              <input autofocus matInput placeholder="Inventario" [formControl]="inventario" type="number"
                [(ngModel)]="escenario.balanceInicial.activo.inventario"
                [(value)]="escenario.balanceInicial.activo.inventario">
              <mat-error *ngIf="inventario.invalid">Required field</mat-error>
            </mat-form-field>
            <mat-form-field class="form-field">
              <input autofocus matInput placeholder="Cuentas a Cobrar" [formControl]="cuentasPorCobrar" type="number"
                [(ngModel)]="escenario.balanceInicial.activo.cuentasPorCobrar"
                [(value)]="escenario.balanceInicial.activo.cuentasPorCobrar">
              <mat-error *ngIf="cuentasPorCobrar.invalid">Required field</mat-error>
            </mat-form-field>
            <mat-form-field class="form-field">
              <input autofocus matInput placeholder="Periodos Cuentas a Cobrar" [formControl]="cuentasPorCobrarPeriodos"
                type="number" [(ngModel)]="escenario.balanceInicial.activo.cuentasPorCobrarPeriodos"
                [(value)]="escenario.balanceInicial.activo.cuentasPorCobrarPeriodos">
              <mat-error *ngIf="cuentasPorCobrarPeriodos.invalid">Required field</mat-error>
            </mat-form-field>
            <!--
            <mat-form-field class="form-field">
              <input autofocus matInput placeholder="Maquinaria" [formControl]="maquinaria" type="number"
                [(ngModel)]="escenario.balanceInicial.activo.maquinaria"
                [(value)]="escenario.balanceInicial.activo.maquinaria">
              <mat-error *ngIf="maquinaria.invalid">Required field</mat-error>
            </mat-form-field>
            <mat-form-field class="form-field">
              <input autofocus matInput placeholder="Amortizacion Acumulada" [formControl]="amortizacionAcumulada"
                type="number" [(ngModel)]="escenario.balanceInicial.activo.amortizacionAcumulada"
                [(value)]="escenario.balanceInicial.activo.amortizacionAcumulada">
              <mat-error *ngIf="amortizacionAcumulada.invalid">Required field</mat-error>
            </mat-form-field>
            -->
          </form>
        </div>
        <div>
          <div style="margin-left:16px;">Pasivo</div>
          <form [formGroup]="pasivoForm" class="balance-form" *ngIf="escenario.balanceInicial.pasivo">
            <mat-form-field class="form-field">
              <input autofocus matInput placeholder="Proveedores" [formControl]="proveedores" type="number"
                [(ngModel)]="escenario.balanceInicial.pasivo.proveedores"
                [(value)]="escenario.balanceInicial.pasivo.proveedores">
            </mat-form-field>
            <mat-form-field class="form-field">
              <input autofocus matInput placeholder="Periodos Proveedores" [formControl]="proveedoresPeriodos"
                type="number" [(ngModel)]="escenario.balanceInicial.pasivo.proveedoresPeriodos"
                [(value)]="escenario.balanceInicial.pasivo.proveedoresPeriodos">
            </mat-form-field>
            <mat-form-field class="form-field">
              <input autofocus matInput placeholder="Deudas Bancarias" [formControl]="deudasBancarias" type="number"
                [(ngModel)]="escenario.balanceInicial.pasivo.deudasBancarias"
                [(value)]="escenario.balanceInicial.pasivo.deudasBancarias">
            </mat-form-field>
            <mat-form-field class="form-field">
              <input autofocus matInput placeholder="Periodos Deudas Bancarias" [formControl]="deudasBancariasPeriodos"
                type="number" [(ngModel)]="escenario.balanceInicial.pasivo.deudasBancariasPeriodos"
                [(value)]="escenario.balanceInicial.pasivo.deudasBancariasPeriodos">
            </mat-form-field>
          </form>
        </div>
        <div>
          <div style="margin-left:16px;">Patrimonio Neto</div>
          <form [formGroup]="patrimonioNetoForm" class="patrimonio-form"
            *ngIf="escenario.balanceInicial.patrimonioNeto">
            <mat-form-field class="form-field">
              <input autofocus matInput placeholder="Capital Social" [formControl]="capitalSocial" type="number"
                [(ngModel)]="escenario.balanceInicial.patrimonioNeto.capitalSocial"
                [(value)]="escenario.balanceInicial.patrimonioNeto.capitalSocial">
            </mat-form-field>
            <mat-form-field class="form-field">
              <input autofocus matInput placeholder="Resultado del ejercicio" [formControl]="resultadoDelEjercicio"
                [(ngModel)]="escenario.balanceInicial.patrimonioNeto.resultadoDelEjercicio" type="number"
                [(value)]="escenario.balanceInicial.patrimonioNeto.resultadoDelEjercicio">
            </mat-form-field>
          </form>
        </div>


      </div>

    </mat-card-content>
  </mat-card>

  <mat-card class="estado-inicial-card" *ngIf="escenario.estadoInicial">
    <mat-card-header>
      <mat-card-title>Estado Inicial</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="estadoInicialForm" class="estado-form">
        <mat-form-field class="form-field">
          <input autofocus matInput placeholder="Costo Fijo" [formControl]="costoFijo"
            [(ngModel)]="escenario.estadoInicial.costoFijo" type="number"
            [(value)]="escenario.estadoInicial.costoFijo">
        </mat-form-field>
        <mat-form-field class="form-field">
          <input autofocus matInput placeholder="Costo Variable" [formControl]="costoVariable"
            [(ngModel)]="escenario.estadoInicial.costoVariable" type="number"
            [(value)]="escenario.estadoInicial.costoVariable">
        </mat-form-field>
        <mat-form-field class="form-field">
          <input autofocus matInput placeholder="Produccion Mensual" [formControl]="produccionMensual"
            [(ngModel)]="escenario.estadoInicial.produccionMensual" type="number"
            [(value)]="escenario.estadoInicial.produccionMensual">
        </mat-form-field>
        <mat-form-field class="form-field">
          <input autofocus matInput placeholder="Stock" [formControl]="stock"
            [(ngModel)]="escenario.estadoInicial.stock" type="number"
            [(value)]="escenario.estadoInicial.stock">
        </mat-form-field>
        <mat-form-field class="form-field">
          <input autofocus matInput placeholder="Calidad" [formControl]="calidad"
            [(ngModel)]="escenario.estadoInicial.calidad" type="number"
            [(value)]="escenario.estadoInicial.calidad">
        </mat-form-field>
      </form>
    </mat-card-content>
  </mat-card>

</div>

<app-financiaciones *ngIf="escenario.id" [escenario]="escenario"></app-financiaciones>
<app-proveedores *ngIf="escenario.id" [escenario]="escenario"></app-proveedores>
<app-decisiones *ngIf="escenario.id" [escenario]="escenario"></app-decisiones>


<button mat-fab color="primary" class="fab" (click)="save()">
  <mat-icon>save</mat-icon>
</button>